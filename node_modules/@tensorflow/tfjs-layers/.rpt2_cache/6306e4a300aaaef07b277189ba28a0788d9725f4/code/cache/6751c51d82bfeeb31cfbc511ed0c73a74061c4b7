{"code":"import * as tslib_1 from \"tslib\";\r\nimport * as tfc from '@tensorflow/tfjs-core';\r\nimport { doc, serialization, tidy } from '@tensorflow/tfjs-core';\r\nimport * as K from './backend/tfjs_backend';\r\nimport { deserializeKerasObject, serializeKerasObject } from './utils/generic_utils';\r\nfunction calcL2Norms(w, axis) {\r\n    return tidy(function () { return tfc.sqrt(tfc.sum(K.square(w), axis, true)); });\r\n}\r\nvar Constraint = (function (_super) {\r\n    tslib_1.__extends(Constraint, _super);\r\n    function Constraint() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    Constraint.prototype.getConfig = function () {\r\n        return {};\r\n    };\r\n    Constraint = tslib_1.__decorate([\r\n        doc({ heading: 'Constraints', subheading: 'Classes', namespace: 'constraints' })\r\n    ], Constraint);\r\n    return Constraint;\r\n}(serialization.Serializable));\r\nexport { Constraint };\r\nvar MaxNorm = (function (_super) {\r\n    tslib_1.__extends(MaxNorm, _super);\r\n    function MaxNorm(config) {\r\n        var _this = _super.call(this) || this;\r\n        _this.defaultMaxValue = 2;\r\n        _this.defaultAxis = 0;\r\n        _this.maxValue =\r\n            config.maxValue != null ? config.maxValue : _this.defaultMaxValue;\r\n        _this.axis = config.axis != null ? config.axis : _this.defaultAxis;\r\n        return _this;\r\n    }\r\n    MaxNorm.prototype.apply = function (w) {\r\n        var _this = this;\r\n        return tidy(function () {\r\n            var norms = calcL2Norms(w, _this.axis);\r\n            var desired = tfc.clipByValue(norms, 0, _this.maxValue);\r\n            return tfc.mul(w, tfc.div(desired, K.scalarPlusArray(K.getScalar(K.epsilon()), norms)));\r\n        });\r\n    };\r\n    MaxNorm.prototype.getConfig = function () {\r\n        return { maxValue: this.maxValue, axis: this.axis };\r\n    };\r\n    MaxNorm.className = 'MaxNorm';\r\n    return MaxNorm;\r\n}(Constraint));\r\nexport { MaxNorm };\r\nserialization.SerializationMap.register(MaxNorm);\r\nvar UnitNorm = (function (_super) {\r\n    tslib_1.__extends(UnitNorm, _super);\r\n    function UnitNorm(config) {\r\n        var _this = _super.call(this) || this;\r\n        _this.defaultAxis = 0;\r\n        _this.axis = config.axis != null ? config.axis : _this.defaultAxis;\r\n        return _this;\r\n    }\r\n    UnitNorm.prototype.apply = function (w) {\r\n        var _this = this;\r\n        return tidy(function () { return tfc.div(w, K.scalarPlusArray(K.getScalar(K.epsilon()), calcL2Norms(w, _this.axis))); });\r\n    };\r\n    UnitNorm.prototype.getConfig = function () {\r\n        return { axis: this.axis };\r\n    };\r\n    UnitNorm.className = 'UnitNorm';\r\n    return UnitNorm;\r\n}(Constraint));\r\nexport { UnitNorm };\r\nserialization.SerializationMap.register(UnitNorm);\r\nvar NonNeg = (function (_super) {\r\n    tslib_1.__extends(NonNeg, _super);\r\n    function NonNeg() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    NonNeg.prototype.apply = function (w) {\r\n        return tfc.relu(w);\r\n    };\r\n    NonNeg.className = 'NonNeg';\r\n    return NonNeg;\r\n}(Constraint));\r\nexport { NonNeg };\r\nserialization.SerializationMap.register(NonNeg);\r\nvar MinMaxNorm = (function (_super) {\r\n    tslib_1.__extends(MinMaxNorm, _super);\r\n    function MinMaxNorm(config) {\r\n        var _this = _super.call(this) || this;\r\n        _this.defaultMinValue = 0.0;\r\n        _this.defaultMaxValue = 1.0;\r\n        _this.defaultRate = 1.0;\r\n        _this.defaultAxis = 0;\r\n        _this.minValue =\r\n            config.minValue != null ? config.minValue : _this.defaultMinValue;\r\n        _this.maxValue =\r\n            config.maxValue != null ? config.maxValue : _this.defaultMaxValue;\r\n        _this.rate = config.rate != null ? config.rate : _this.defaultRate;\r\n        _this.axis = config.axis != null ? config.axis : _this.defaultAxis;\r\n        return _this;\r\n    }\r\n    MinMaxNorm.prototype.apply = function (w) {\r\n        var _this = this;\r\n        return tidy(function () {\r\n            var norms = calcL2Norms(w, _this.axis);\r\n            var desired = tfc.add(K.scalarTimesArray(K.getScalar(_this.rate), tfc.clipByValue(norms, _this.minValue, _this.maxValue)), K.scalarTimesArray(K.getScalar(1.0 - _this.rate), norms));\r\n            return tfc.mul(w, tfc.div(desired, K.scalarPlusArray(K.getScalar(K.epsilon()), norms)));\r\n        });\r\n    };\r\n    MinMaxNorm.prototype.getConfig = function () {\r\n        return {\r\n            minValue: this.minValue,\r\n            maxValue: this.maxValue,\r\n            rate: this.rate,\r\n            axis: this.axis\r\n        };\r\n    };\r\n    MinMaxNorm.className = 'MinMaxNorm';\r\n    return MinMaxNorm;\r\n}(Constraint));\r\nexport { MinMaxNorm };\r\nserialization.SerializationMap.register(MinMaxNorm);\r\nexport var CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP = {\r\n    'maxNorm': 'MaxNorm',\r\n    'minMaxNorm': 'MinMaxNorm',\r\n    'nonNeg': 'NonNeg',\r\n    'unitNorm': 'UnitNorm'\r\n};\r\nexport function serializeConstraint(constraint) {\r\n    return serializeKerasObject(constraint);\r\n}\r\nexport function deserializeConstraint(config, customObjects) {\r\n    if (customObjects === void 0) { customObjects = {}; }\r\n    return deserializeKerasObject(config, serialization.SerializationMap.getMap().classNameMap, customObjects, 'constraint');\r\n}\r\nexport function getConstraint(identifier) {\r\n    if (identifier == null) {\r\n        return null;\r\n    }\r\n    if (typeof identifier === 'string') {\r\n        var className = identifier in CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP ?\r\n            CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP[identifier] :\r\n            identifier;\r\n        var config = { className: className, config: {} };\r\n        return deserializeConstraint(config);\r\n    }\r\n    else if (identifier instanceof Constraint) {\r\n        return identifier;\r\n    }\r\n    else {\r\n        return deserializeConstraint(identifier);\r\n    }\r\n}\r\n//# sourceMappingURL=constraints.js.map","map":"{\"version\":3,\"file\":\"constraints.js\",\"sourceRoot\":\"\",\"sources\":[\"src/constraints.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/usr/local/google/home/smilkov/code/tfjs-layers/constraints.d.ts","text":"import { serialization, Tensor } from '@tensorflow/tfjs-core';\r\nexport declare abstract class Constraint extends serialization.Serializable {\r\n    abstract apply(w: Tensor): Tensor;\r\n    getConfig(): serialization.ConfigDict;\r\n}\r\nexport interface MaxNormConfig {\r\n    maxValue?: number;\r\n    axis?: number;\r\n}\r\nexport declare class MaxNorm extends Constraint {\r\n    static readonly className: string;\r\n    private maxValue;\r\n    private axis;\r\n    private readonly defaultMaxValue;\r\n    private readonly defaultAxis;\r\n    constructor(config: MaxNormConfig);\r\n    apply(w: Tensor): Tensor;\r\n    getConfig(): serialization.ConfigDict;\r\n}\r\nexport interface UnitNormConfig {\r\n    axis?: number;\r\n}\r\nexport declare class UnitNorm extends Constraint {\r\n    static readonly className: string;\r\n    private axis;\r\n    private readonly defaultAxis;\r\n    constructor(config: UnitNormConfig);\r\n    apply(w: Tensor): Tensor;\r\n    getConfig(): serialization.ConfigDict;\r\n}\r\nexport declare class NonNeg extends Constraint {\r\n    static readonly className: string;\r\n    apply(w: Tensor): Tensor;\r\n}\r\nexport interface MinMaxNormConfig {\r\n    minValue?: number;\r\n    maxValue?: number;\r\n    axis?: number;\r\n    rate?: number;\r\n}\r\nexport declare class MinMaxNorm extends Constraint {\r\n    static readonly className: string;\r\n    private minValue;\r\n    private maxValue;\r\n    private rate;\r\n    private axis;\r\n    private readonly defaultMinValue;\r\n    private readonly defaultMaxValue;\r\n    private readonly defaultRate;\r\n    private readonly defaultAxis;\r\n    constructor(config: MinMaxNormConfig);\r\n    apply(w: Tensor): Tensor;\r\n    getConfig(): serialization.ConfigDict;\r\n}\r\nexport declare type ConstraintIdentifier = 'maxNorm' | 'minMaxNorm' | 'nonNeg' | 'unitNorm' | string;\r\nexport declare const CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP: {\r\n    [identifier in ConstraintIdentifier]: string;\r\n};\r\nexport declare function serializeConstraint(constraint: Constraint): serialization.ConfigDictValue;\r\nexport declare function deserializeConstraint(config: serialization.ConfigDict, customObjects?: serialization.ConfigDict): Constraint;\r\nexport declare function getConstraint(identifier: ConstraintIdentifier | serialization.ConfigDict | Constraint): Constraint;\r\n"}}
